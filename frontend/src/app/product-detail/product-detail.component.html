<div class="product-detail" *ngIf="product; else loadingOrError" aria-labelledby="productTitle">

  <div class="product-top">
    <!-- Image produit -->
    <img
      [src]="product.imageUrl?.trim() !== '' ? product.imageUrl : 'assets/default-product.jpg'"
      [alt]="product.title || 'Produit sans titre'"
      class="product-detail-image"
      loading="lazy"
    />

    <!-- Infos produit -->
    <div class="product-info">
      <h1 id="productTitle">{{ product.title || 'Produit sans titre' }}</h1>

      <!-- âœ… Prix de la variation sÃ©lectionnÃ©e -->
      <p *ngIf="getSelectedPrice() !== null" class="price">
        Prix : <strong>{{ getSelectedPrice() | currency:'EUR':'symbol':'1.2-2' }}</strong>
      </p>
      <p *ngIf="getSelectedPrice() === null" class="price">Prix non disponible</p>

      <!-- SÃ©lecteur poids -->
      <label for="variation">Poids</label>
      <select id="variation" [(ngModel)]="selectedVariationId">
        <option *ngFor="let variation of product.variations" [value]="variation.id">
          {{ variation.weight }} - {{ variation.price | currency:'EUR':'symbol':'1.2-2' }}
        </option>
      </select>

      <!-- QuantitÃ© -->
      <label for="quantity">QuantitÃ©</label>
      <input
        id="quantity"
        type="number"
        min="1"
        [(ngModel)]="quantity"
        inputmode="numeric"
        aria-label="Choisir la quantitÃ©"
      />

      <!-- Bouton -->
      <button
        class="add-to-cart-btn"
        type="button"
        (click)="addToCart()"
        [disabled]="isAdding"
        aria-label="Ajouter le produit au panier"
      >
        {{ isAdding ? 'Ajout en coursâ€¦' : 'Ajouter au panier ðŸ›’' }}
      </button>

      <!-- Toast feedback -->
      <p class="toast success" *ngIf="toast?.type === 'success'">{{ toast?.msg }}</p>
      <p class="toast error" *ngIf="toast?.type === 'error'">{{ toast?.msg }}</p>
    </div>
  </div>

  <!-- Affiche le SKU -->
  <p *ngIf="getSelectedVariation()" class="sku">
    RÃ©f : {{ getSelectedVariation().sku }}
  </p>

  <!-- Description longue formatÃ©e -->
  <div class="long-description" aria-label="Description du produit">
    <p [innerHTML]="formatDescription(product.description)"></p>
  </div>
</div>

<ng-template #loadingOrError>
  <p>{{ errorMessage || 'Chargement du produitâ€¦' }}</p>
</ng-template>

<!-- SEO : donnÃ©es structurÃ©es JSON-LD Produit -->
<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@type": "Product",
  "name": "{{ product?.title || 'Produit' }}",
  "sku": "{{ getSelectedVariation()?.sku || '' }}",
  "offers": {
    "@type": "Offer",
    "price": "{{ getSelectedPrice() || '' }}",
    "priceCurrency": "EUR",
    "availability": "https://schema.org/InStock"
  }
}
</script>
